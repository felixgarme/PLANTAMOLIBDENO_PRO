<!DOCTYPE html>
<!-- __V3D_PUZZLES__ - enable Puzzles button in the App Manager -->
<!-- __V3D_TEMPLATE__ - template-based file; delete this line to prevent this file from being updated -->
<html lang="en">
<head>
  <title>Planta</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">

  <!-- Search Engines -->
  <meta name="description" content="Interactive 3D Web application made with Verge3D. Immerse yourself in amazing graphics experience offered by state-of-the art WebGL and HTML5 technologies.">
  <!-- Twitter -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Verge3D Web Interactive">
  <meta name="twitter:description" content="Interactive 3D Web application made with Verge3D. Immerse yourself in amazing graphics experience offered by state-of-the art WebGL and HTML5 technologies.">
  <meta name="twitter:image:src" content="https://cdn.soft8soft.com/images/player_socials.jpg">
  <!-- Open Graph -->
  <meta property="og:title" content="Verge3D Web Interactive">
  <meta property="og:description" content="Interactive 3D Web application made with Verge3D. Immerse yourself in amazing graphics experience offered by state-of-the art WebGL and HTML5 technologies.">
  <meta property="og:image" content="https://cdn.soft8soft.com/images/player_socials.jpg">
  <meta property="og:type" content="website">

  <meta name="generator" content="Verge3D 4.8.0">

  <!-- favicons -->
  <link rel="apple-touch-icon" sizes="180x180" href="media/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="48x48" href="media/favicon-48x48.png">
  <link rel="icon" type="image/png" sizes="32x32" href="media/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="media/favicon-16x16.png">
  <link rel="manifest" href="media/manifest.json">
  <link rel="mask-icon" href="media/safari-pinned-tab.svg" color="#0048a5">
  <meta name="theme-color" content="#ffffff">

  <script src="v3d.js"></script>
    <script src="METSO.js"></script>

  <link rel="stylesheet" type="text/css" href="METSO.css">

  <style>
    #v3d-loader {
      position: fixed;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #ffffff;
      z-index: 99999;
      transition: opacity 0.8s cubic-bezier(.2, .8, .2, 1);
      opacity: 1;
      visibility: visible;
      pointer-events: all;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    .v3d-loader-inner {
      text-align: center;
      will-change: transform;
    }

    .v3d-loader-word {
      display: inline-flex;
      gap: 6px;
      align-items: baseline;
      justify-content: center;
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      font-weight: 700;
      color: #031794;
      letter-spacing: 1px;
      font-size: clamp(28px, 6vw, 96px);
    }

    .v3d-loader-letter {
      display: inline-block;
      transform-origin: center bottom;
      --paint-duration: 0.25s;
      color: #ffffff;
      animation-duration: var(--paint-duration);
      animation-name: v3d-paint;
      animation-timing-function: ease-out;
      animation-iteration-count: 1;
      animation-fill-mode: forwards;
      animation-delay: calc(var(--i, 0) * 0.1s);
      will-change: color;
      user-select: none;
      -webkit-user-select: none;
    }

    @keyframes v3d-paint {
      0% { color: #ffffff; }
      100% { color: #031794; }
    }

    .v3d-loader-percentage {
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      font-weight: 500;
      font-size: clamp(18px, 3vw, 32px);
      color: #031794;
      margin-top: 25px;
      letter-spacing: 1px;
      opacity: 0;
      animation: v3d-fade-in 0.5s ease-out 0.5s forwards;
      will-change: opacity, content;
      user-select: none;
      -webkit-user-select: none;
    }

    @keyframes v3d-fade-in {
      0% { opacity: 0; transform: translateY(10px); }
      100% { opacity: 1; transform: translateY(0); }
    }

    .v3d-loader-paused .v3d-loader-letter {
      animation-play-state: paused !important;
    }

    .v3d-loader-fade {
      opacity: 0;
      pointer-events: none;
    }

    @media (prefers-reduced-motion: reduce) {
      .v3d-loader-letter {
        animation: none;
        color: #031794 !important;
      }
      .v3d-loader-percentage {
        animation: none;
        opacity: 1;
      }
    }
  </style>
</head>

<body>
  <div id="v3d-loader" aria-hidden="true">
    <div class="v3d-loader-inner">
      <img src="../img/logo_full.png" style="width:700px; margin:30px 30px -35px 0px;">
      <div class="v3d-loader-percentage" id="v3d-loader-percentage">0%</div>
    </div>
  </div>

  <div id="v3d-container">
    <div id="fullscreen-button" class="fullscreen-button fullscreen-open" title="Toggle fullscreen mode"></div>
  </div>

  <script>
    (function() {
      var MAX_TRIES = 200;
      var tries = 0;
      var pollInterval = 100;
      var installed = false;
      var loaderHidden = false;
      var percEl = document.getElementById('v3d-loader-percentage');
      var currentPercentage = 0;
      var percTimerId;

      function updatePercentage() {
        if (loaderHidden || !percEl) {
          if (percTimerId) clearTimeout(percTimerId);
          return;
        }

        var increment;
        var nextInterval;

        if (currentPercentage < 80) {
          increment = Math.max(1, Math.floor(Math.random() * 3));
          nextInterval = 30 + Math.random() * 20;
        } else if (currentPercentage < 99) {
          increment = 1;
          nextInterval = 250 + Math.random() * 200;
        } else {
          currentPercentage = 99;
          percEl.textContent = currentPercentage + '%';
          return;
        }

        currentPercentage = Math.min(currentPercentage + increment, 99);
        percEl.textContent = currentPercentage + '%';
        percTimerId = setTimeout(updatePercentage, nextInterval);
      }

      if (percEl) {
        percTimerId = setTimeout(updatePercentage, 30);
      }

      function hideLoaderOnce() {
        if (percTimerId) {
          clearTimeout(percTimerId);
          percTimerId = null;
        }

        if (percEl && !loaderHidden) {
          percEl.textContent = '100%';
        }

        if (loaderHidden) return;
        loaderHidden = true;

        var loader = document.getElementById('v3d-loader');
        if (!loader) return;

        loader.classList.add('v3d-loader-paused');
        void loader.offsetWidth;
        loader.classList.add('v3d-loader-fade');

        var onTransitionEnd = function(e) {
          if (e.propertyName === 'opacity') {
            try { loader.removeEventListener('transitionend', onTransitionEnd); } catch(_) {}
            loader.setAttribute('aria-hidden', 'true');
            loader.style.visibility = 'hidden';
            loader.style.zIndex = '-1';
            if (loader.parentNode) {
              try { loader.parentNode.removeChild(loader); } catch(_) {}
            }
          }
        };

        loader.addEventListener('transitionend', onTransitionEnd);

        setTimeout(function() {
          var l = document.getElementById('v3d-loader');
          if (l) {
            l.setAttribute('aria-hidden', 'true');
            l.style.visibility = 'hidden';
            l.style.zIndex = '-1';
            if (l.parentNode)
              try { l.parentNode.removeChild(l); } catch(_) {}
          }
        }, 1200);
      }

      function wrapExistingFunction(proc) {
        try {
          var existing = proc["inicio"];
          if (typeof existing === 'function' && !existing.__v3d_wrapped) {
            var orig = existing;
            var wrapper = function() {
              try { orig.apply(this, arguments); }
              catch(e) { console.error("Error en inicio (orig):", e); }
              hideLoaderOnce();
            };
            wrapper.__v3d_wrapped = true;
            try {
              proc["inicio"] = wrapper;
            } catch(e) {
              Object.defineProperty(proc, "inicio", {
                configurable: true,
                enumerable: true,
                writable: true,
                value: wrapper
              });
            }
            return true;
          }
        } catch(e) {}
        return false;
      }

      function installInterceptorOnFutureAssignment(proc) {
        try {
          var descriptor = Object.getOwnPropertyDescriptor(proc, "inicio");
          if (descriptor && descriptor.configurable === false) return;

          var currentValue = proc["inicio"];
          var saved = currentValue;

          Object.defineProperty(proc, "inicio", {
            configurable: true,
            enumerable: true,
            get: function() { return saved; },
            set: function(fn) {
              if (typeof fn === 'function') {
                var wrapped = function() {
                  try { fn.apply(this, arguments); }
                  catch(e) { console.error("Error en inicio (set):", e); }
                  hideLoaderOnce();
                };
                wrapped.__v3d_wrapped = true;
                saved = wrapped;
              } else {
                saved = fn;
              }
            }
          });
          return true;
        } catch(e) {
          return false;
        }
      }

      function tryInstall() {
        tries++;
        if (!window.v3d || !v3d.puzzles || !v3d.puzzles.procedures) {
          if (tries > MAX_TRIES) clearInterval(intervalId);
          return;
        }

        var proc = v3d.puzzles.procedures;
        var wrappedNow = wrapExistingFunction(proc);
        var intercepted = installInterceptorOnFutureAssignment(proc);

        if (wrappedNow || intercepted) {
          installed = true;
          clearInterval(intervalId);
        } else {
          if (tries > MAX_TRIES) clearInterval(intervalId);
        }
      }

      var intervalId = setInterval(tryInstall, pollInterval);
      tryInstall();
    })();
  </script>
</body>
</html>
